name: Build All Services

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read
  packages: write

jobs:
  build-admin:
    uses: ./.github/workflows/build-admin-backend.yml
    secrets: inherit
    permissions:
      contents: read
      packages: write

  build-store:
    uses: ./.github/workflows/build-store-backend.yml
    secrets: inherit
    permissions:
      contents: read
      packages: write

  build-user:
    uses: ./.github/workflows/build-user-backend.yml
    secrets: inherit
    permissions:
      contents: read
      packages: write

  build-terminal:
    uses: ./.github/workflows/build-terminal-backend.yml
    secrets: inherit
    permissions:
      contents: read
      packages: write

  build-frontend:
    uses: ./.github/workflows/build-frontend.yml
    secrets: inherit

  summary:
    needs: [build-admin, build-store, build-user, build-terminal, build-frontend]
    runs-on: ubuntu-latest
    steps:
      - name: Build Summary
        run: |
          echo "✅ All services built successfully!"
          echo ""
          echo "📦 Backend Images pushed to GitHub Container Registry:"
          echo "   - Admin Backend: ghcr.io/${{ github.repository }}/admin-backend:latest"
          echo "   - Store Backend: ghcr.io/${{ github.repository }}/store-backend:latest"
          echo "   - User Backend: ghcr.io/${{ github.repository }}/user-backend:latest"
          echo "   - Terminal Backend: ghcr.io/${{ github.repository }}/terminal-backend:latest"
          echo ""
          echo "🌐 Frontend: Next.js build completed"
          echo ""
          echo "🚀 Ready for deployment!"
