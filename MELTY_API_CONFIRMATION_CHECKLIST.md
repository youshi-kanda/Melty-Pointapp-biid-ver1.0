# MELTY API 確認事項チェックリスト（MELTY担当者様記入用）
**作成日**: 2025年11月13日  
**目的**: MELTY＋連携実装に必要なAPI仕様の確認

---

## ✅ 必須確認事項

### 1️⃣ ログイン認証API

**Q1: APIエンドポイントURL**
```
ベースURL: http://app-melty.com/melty-app_system/api/

ログインAPI: /________________  
（例: /users/login, /auth/login, /authenticate など）
```

**Q2: HTTPメソッド**
```
□ POST
□ GET
□ その他: ________________
```

**Q3: リクエスト形式**
```
□ JSON (application/json)
□ FormData (application/x-www-form-urlencoded)
□ その他: ________________
```

**Q4: リクエストパラメータ**
```
メールアドレスのパラメータ名: ________________
（例: email, username, mail など）

パスワードのパラメータ名: ________________
（例: password, pass, pwd など）

その他必須パラメータ（あれば）: ________________
```

**Q5: リクエスト例をご記入ください**
```json
// JSON形式の場合
{
  "____________": "user@example.com",
  "____________": "password123"
}

// または FormData形式の場合
____________=user@example.com&____________=password123
```

**Q6: ログイン成功時のレスポンス例をご記入ください**
```json
// 実際のレスポンス例を貼り付けてください
// （個人情報はダミーデータに置き換えてください）
{
  
  
  
}
```

**Q7: 会員種別の判定方法**
```
無料会員と有料会員を区別するフィールド名: ________________
（例: membership_type, is_premium, plan など）

無料会員の値: ________________
（例: "free", "basic", false など）

有料会員の値: ________________
（例: "premium", "paid", true など）
```

**Q8: ユーザーIDのフィールド名**
```
ユーザーを一意に識別するIDのフィールド名: ________________
（例: user_id, id, member_id など）
```

**Q9: ログイン失敗時のレスポンス**
```
HTTPステータスコード: ________

レスポンス例:
{
  
  
}
```

---

## 🔄 オプション確認事項（あると望ましい）

### 2️⃣ ユーザープロフィール取得API（ログイン後の会員情報同期用）

**Q10: プロフィール取得APIの有無**
```
□ 専用のプロフィール取得APIがある
  → エンドポイント: /________________
  
□ ログインAPIのレスポンスに全て含まれる（専用APIは不要）

□ その他: ________________________________________________
```

**Q11: プロフィールAPI認証方式（専用APIがある場合）**
```
□ トークンをヘッダーに含める
  ヘッダー名: ________________
  （例: Authorization: Bearer {token}）

□ セッションCookie

□ その他: ________________________________________________
```

**Q12: プロフィールAPIのレスポンス例（専用APIがある場合）**
```json
// 貼り付けてください
{
  
  
}
```

---

### 3️⃣ 会員解約・退会時の動作

**Q13: 退会済みユーザーがログインAPIを呼んだ場合の動作**
```
□ HTTPエラーが返る
  → ステータスコード: ________
  
□ success: false で返る
  → エラーメッセージ: ________________________________________________

□ レスポンスに status: "inactive" などのフラグが含まれる
  → フィールド名: ________________

□ その他: ________________________________________________
```

---

### 4️⃣ テスト環境・アカウント

**Q14: テスト環境の有無**
```
□ 開発環境がある
  → URL: ________________________________________________

□ 本番環境のみ

□ その他: ________________________________________________
```

**Q15: テストアカウントの提供**
```
以下のテストアカウントをご提供いただけますか？

□ 無料会員アカウント
  メールアドレス: ________________________________________________
  パスワード: ________________________________________________

□ 有料会員アカウント
  メールアドレス: ________________________________________________
  パスワード: ________________________________________________

□ 退会済みアカウント（任意）
  メールアドレス: ________________________________________________

□ テストアカウントは提供不可（本番で慎重にテスト）
```

---

### 5️⃣ API制限・セキュリティ

**Q16: API呼び出し制限**
```
□ レート制限あり
  制限: ________ リクエスト/秒（または分）
  超過時のHTTPステータスコード: ________

□ レート制限なし

□ 不明
```

**Q17: 推奨タイムアウト時間**
```
推奨タイムアウト: ________ 秒

□ 特に指定なし
```

**Q18: API仕様書・ドキュメントの有無**
```
□ API仕様書を提供可能
  → 形式: □ PDF  □ Swagger/OpenAPI  □ Webページ  □ その他: ________

□ 仕様書はないが、サンプルコード提供可能
  → 言語: ________________________________________________

□ 本チェックリストのみ

□ その他: ________________________________________________
```

---

## 📌 記入者情報（MELTY担当者様）

```
担当者名: ________________________________________________

部署: ________________________________________________

メールアドレス: ________________________________________________

電話番号（任意）: ________________________________________________

記入日: ________ 年 ________ 月 ________ 日
```

---

## 🚀 MELTY＋開発チームからの補足

### このチェックリストで確認したいこと

**MELTY＋アプリでは、以下の連携機能を実装予定です:**

1. **新規登録時のMELTY連携**
   - ユーザーがMELTYメールアドレス・パスワードで登録
   - MELTY APIで認証し、会員種別を自動判定
   - 無料会員 → Silverランク（1,000pt）
   - 有料会員 → Goldランク（2,000pt）

2. **既存ユーザーの後からMELTY連携**
   - マイページから「MELTY連携」を選択
   - MELTYメールアドレス・パスワードで認証
   - ランクアップ + ボーナスポイント付与

3. **ログイン時の会員種別同期**
   - MELTY＋にログインする際、最新の会員種別を確認
   - MELTY側で無料→有料にアップグレードした場合、自動的にGoldランクへ

### 必要最小限の情報

上記を実装するために**絶対に必要**な情報は以下の3点のみです:

1. ✅ **ログインAPIのエンドポイント** (Q1)
2. ✅ **リクエストパラメータ名** (Q4)
3. ✅ **レスポンス内の会員種別フィールド** (Q7)

**これさえ分かれば、すぐに実装を開始できます！**

その他の項目は、品質向上や将来の拡張のための確認事項です。

---

## 📨 ご返信方法

### パターンA: このファイルに直接記入して返信
1. このMarkdownファイルの空欄 `________________` に記入
2. チェックボックス `□` を `☑` に変更
3. ファイルを添付してメール返信

### パターンB: 別途資料を提供
- API仕様書PDF
- Postmanコレクション
- サンプルコード
など、既存の資料があればそちらをご提供ください。

### パターンC: オンラインミーティング
画面共有で一緒に確認しながら記入することも可能です。  
所要時間: 約30分

---

## ⏱️ 回答期限

MELTY＋アプリのリリーススケジュールに影響するため、  
**可能な限り早めのご回答**をお願いいたします。

目安: ________ 年 ________ 月 ________ 日まで

---

## 📞 お問い合わせ先

ご不明な点がございましたら、お気軽にお問い合わせください。

MELTY＋開発チーム  
Email: ________________________________________________  
電話: ________________________________________________

---

**以上、ご協力のほどよろしくお願いいたします。**

---

#### Q1-4: レスポンス形式（失敗時）
```json
{
  "success": false,
  "error": "Invalid credentials"    // エラーメッセージ: □ error  □ message  □ その他: ______
}
```

または

```
HTTPステータスコード: □ 401  □ 400  □ その他: ______
```

**質問**: 
ログイン失敗時のレスポンス形式を教えてください。

**理由**: 
MELTY＋アプリでユーザーに適切なエラーメッセージを表示するため。

---

### 1.2 会員種別の判定

#### Q2-1: 無料会員と有料会員の区別
```
□ パターンA: membership_type フィールド
   無料会員: "free" または "basic" または ______
   有料会員: "premium" または "paid" または ______

□ パターンB: is_premium フラグ
   無料会員: false
   有料会員: true

□ パターンC: plan フィールド
   無料会員: ______
   有料会員: ______

□ パターンD: その他
   説明: ______
```

**質問**: 
ログインAPIまたはプロフィールAPIで、無料会員と有料会員を区別する方法を教えてください。

**理由**: 
会員種別に応じて自動的にランクを設定します（無料=Silver、有料=Gold）。

---

#### Q2-2: 会員種別の値の種類
```
想定される値:
□ "free" / "premium"
□ "basic" / "pro"
□ true / false（is_premiumの場合）
□ その他: ______

複数の会員種別がある場合:
□ 無料会員のみ（1種類）
□ 有料会員が複数（例: スタンダード、プレミアム、VIPなど）
  → 詳細: ______
```

**質問**: 
有料会員に複数のプランがある場合、それぞれの値を教えてください。

**理由**: 
MELTY＋では現状、無料会員=Silver、有料会員=Goldの2段階ですが、
将来的に有料会員の中でも区別が必要かもしれません。

---

### 1.3 プロフィール取得API（オプション）

#### Q3-1: プロフィールAPIの有無
```
□ プロフィール専用APIがある
  → エンドポイント: /user/profile/ または ______
  
□ ログインAPIのレスポンスに全て含まれる（専用APIなし）

□ その他: ______
```

**質問**: 
ログイン後に会員情報を取得する専用のAPIはありますか？

**理由**: 
ログイン時に会員種別の変更（無料→有料アップグレード）を検知するために、
最新の会員情報を取得したい場合があります。

---

#### Q3-2: プロフィールAPI認証方式（Q3-1で「ある」の場合）
```
□ 認証トークンをヘッダーに含める
  例: Authorization: Bearer abc123...
  
□ セッションCookie

□ APIキー

□ その他: ______
```

**質問**: 
プロフィールAPIを呼び出す際の認証方法を教えてください。

---

### 1.4 会員解約・退会時の動作

#### Q4-1: 退会後のログインAPI動作
```
□ パターンA: HTTPエラーが返る
  → ステータスコード: □ 404  □ 403  □ 401  □ その他: ______
  
□ パターンB: success: false で返る
  → error メッセージ: ______
  
□ パターンC: status: "inactive" などのフィールドで判別可能
  
□ パターンD: その他: ______
```

**質問**: 
MELTYアプリを退会したユーザーが、同じメールアドレス・パスワードでログインAPIを呼んだ場合、
どのようなレスポンスが返りますか？

**理由**: 
MELTY退会済みユーザーの連携を自動的に解除するため。

---

#### Q4-2: 退会後のデータ保持期間
```
□ 即座に削除（ログインAPI呼び出し不可）
□ 一定期間保持: ______ 日間
□ 永続的に保持（is_deleted フラグなど）
□ その他: ______
```

**質問**: 
退会後、ユーザーデータはいつまで残りますか？

**理由**: 
再登録時の対応を検討するため。

---

## 2. 推奨確認事項（実装の質を高めるため）

### 2.1 テスト環境・アカウント

#### Q5-1: テスト環境の有無
```
□ 開発環境あり
  → URL: ______
  → テストアカウント提供可能: □ はい  □ いいえ
  
□ 本番環境のみ
  → テストアカウント提供可能: □ はい  □ いいえ
  
□ その他: ______
```

**質問**: 
MELTY＋の開発・テストで使用できるテスト環境またはテストアカウントはありますか？

**理由**: 
実装後の動作確認を行うため。

---

#### Q5-2: テストアカウントの種類
```
必要なテストアカウント:
□ 無料会員アカウント（1つ以上）
□ 有料会員アカウント（1つ以上）
□ 退会済みアカウント（1つ）

提供可能:
□ 全て可能
□ 一部のみ: ______
□ 不可（本番で慎重にテスト）
```

**質問**: 
以下のテストアカウントを提供いただけますか？
- 無料会員アカウント
- 有料会員アカウント
- 退会済みアカウント

**理由**: 
各シナリオの動作確認を行うため。

---

### 2.2 API制限・運用

#### Q6-1: レート制限
```
□ レート制限あり
  → 制限: ______ リクエスト/秒（または分）
  → 超過時のレスポンス: HTTPステータス ______
  
□ レート制限なし

□ 不明
```

**質問**: 
ログインAPIやプロフィールAPIに呼び出し回数制限はありますか？

**理由**: 
大量のユーザーが同時にログインする場合に備えて、リトライロジックを実装するため。

---

#### Q6-2: タイムアウト推奨値
```
□ 推奨タイムアウト: ______ 秒
□ 特になし
```

**質問**: 
API呼び出し時の推奨タイムアウト時間はありますか？

**理由**: 
MELTY APIが遅延した場合でもMELTY＋アプリが応答不能にならないようにするため。

---

### 2.3 会員種別変更の通知

#### Q7-1: Webhook機能の有無
```
□ Webhookあり
  → イベント: 会員種別変更、退会など
  → 設定方法: ______
  
□ Webhookなし
  → 代替案: MELTY＋アプリ側でログイン時に同期

□ 検討中
```

**質問**: 
MELTY側から会員種別の変更（無料→有料、退会など）をWebhookで通知する機能はありますか？

**理由**: 
Webhookがあれば、ユーザーがMELTY＋にログインしなくても
即座にランクを更新できます。なくても問題ありません（ログイン時に同期します）。

---

### 2.4 個人情報・セキュリティ

#### Q8-1: パスワードのハッシュ化
```
□ MELTY側でハッシュ化済み
□ MELTY＋からプレーンテキストで送信してOK（HTTPS通信）
□ その他: ______
```

**質問**: 
ログインAPIにパスワードを送信する際、ハッシュ化が必要ですか？

**理由**: 
セキュリティ要件を満たすため。

---

#### Q8-2: MELTY＋でのデータ保存範囲
```
MELTY＋で保存してよいデータ:
□ ユーザーID（melty_user_id）
□ メールアドレス（melty_email）
□ 氏名
□ 会員種別（membership_type）
□ その他プロフィール情報: ______

保存してはいけないデータ:
□ パスワード（当然保存しません）
□ その他: ______
```

**質問**: 
MELTY＋のデータベースに保存してよいMELTY会員情報の範囲を教えてください。

**理由**: 
個人情報保護法やプライバシーポリシーを遵守するため。

---

## 3. 将来的な拡張に関する確認

### 3.1 API仕様書の提供

```
□ API仕様書（ドキュメント）を提供可能
  → 形式: □ Swagger/OpenAPI  □ PDF  □ Webページ  □ その他: ______
  
□ 仕様書はないが、サンプルコード提供可能
  → 言語: ______
  
□ 口頭での説明のみ

□ その他: ______
```

**質問**: 
MELTY APIの詳細仕様書や、既存のクライアント実装（iOS/Androidアプリなど）のサンプルコードを
共有いただくことは可能ですか？

**理由**: 
正確な実装のため、および将来の機能拡張時の参考にするため。

---

### 3.2 今後の機能追加予定

```
□ MELTY側でSSO機能の追加予定あり
  → 時期: ______
  
□ 会員種別の増加予定あり（例: VIPプラン）
  → 時期: ______
  
□ その他API変更予定: ______

□ 特になし
```

**質問**: 
MELTY側で今後予定されている機能追加や仕様変更はありますか？

**理由**: 
将来の拡張に備えた柔軟な設計を行うため。

---

## 4. 確認フロー

### ステップ1: 最小限の情報収集
まずは **必須確認事項（第1章）** のみ確認し、実装を開始できる状態にする。

### ステップ2: 初期実装
第1章の情報だけで基本的な連携機能を実装。

### ステップ3: テスト・改善
**推奨確認事項（第2章）** を確認し、品質とセキュリティを向上。

### ステップ4: 将来対応
**拡張確認事項（第3章）** を確認し、長期的な保守性を確保。

---

## 5. 確認方法の提案

### 方法A: このチェックリストを送付
本ファイルをMELTY担当者に送付し、回答をもらう。

### 方法B: 実際のAPIレスポンスを共有
MELTY担当者に以下をお願いする:
```bash
# ログインAPIの例
curl -X POST http://app-melty.com/melty-app_system/api/login/ \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"test123"}'
  
---

## 6. 確認後のアクション

### 全ての必須項目が確認できた場合
→ **即座に実装開始可能**

### 一部不明な項目がある場合
→ **仮定を置いて実装し、柔軟に対応できる設計にする**

例: 会員種別のフィールド名が不明な場合
```python
def _extract_membership_type(profile):
    """複数パターンに対応"""
    # パターン1
    if 'membership_type' in profile:
        return profile['membership_type']
    # パターン2
    if 'is_premium' in profile:
        return 'premium' if profile['is_premium'] else 'free'
    # パターン3
    if 'plan' in profile:
        return profile['plan']
    # デフォルト
    return 'free'
```

---

## 7. まとめ

### 最小限必要な情報（実装開始に必須）
1. ログインAPIのエンドポイントとパラメータ名
2. レスポンスに含まれるユーザーIDと会員種別のフィールド名
3. 無料会員と有料会員の値の違い

### あると嬉しい情報
1. テストアカウント（無料・有料・退会済み）
2. API仕様書またはサンプルコード
3. Webhook機能の有無

### 最悪なくても対応可能
1. レート制限（デフォルトで10秒タイムアウト設定）
2. プロフィール専用API（ログインAPIで取得できれば十分）
3. Webhook（ログイン時同期で代替）

**本チェックリストをMELTY担当者に送付し、回答をいただければ実装を開始できます。**
