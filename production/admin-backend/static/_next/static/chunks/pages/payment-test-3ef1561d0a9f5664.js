(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[886],{8658:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/payment-test",function(){return n(2410)}])},5925:function(e,t,n){"use strict";n.d(t,{Kb:function(){return s},kG:function(){return o}});let r={BASE_URL:"https://api.biid-point.com",ENDPOINTS:{LOGIN:"/api/auth/login/",REFRESH:"/api/auth/refresh/",LOGOUT:"/api/auth/logout/",PAYMENTS:"/api/core/payments/",PAYMENT_STATUS:"/api/core/payments/status/",MOCK_PAYMENT:"/api/core/payments/mock/",GMOPG_INITIATE:"/api/gmopg/payment/initiate/",GMOPG_STATUS:"/api/gmopg/payment/status/",POINTS_GRANT:"/api/core/points/grant/",POINTS_HISTORY:"/api/core/points/history/",USER_ME:"/api/core/user/me/",HEALTH:"/api/health/",STATUS:"/api/status/"},TIMEOUT:3e4,HEADERS:{"Content-Type":"application/json",Accept:"application/json"}};function o(){{let e=window.location.hostname;if("biid-user.fly.dev"===e||e.includes("biid-user"))return"https://biid-user-api.fly.dev";if("localhost"===e||"127.0.0.1"===e)return"http://localhost:8000"}return"https://biid-user-api.fly.dev"}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(r.BASE_URL).concat(e);try{let e=await fetch(n,{...t,headers:{...r.HEADERS,...t.headers},signal:AbortSignal.timeout(r.TIMEOUT)}),o=e.headers.get("content-type");if(!(null==o?void 0:o.includes("application/json"))){let t=await e.text();if(console.warn("Non-JSON response from API:",{url:n,status:e.status,contentType:o,preview:t.substring(0,200)}),t.includes("<!DOCTYPE")||t.includes("<html"))throw Error("Server returned HTML error page (".concat(e.status,")"))}if(!e.ok)throw Error("API Error: ".concat(e.status," ").concat(e.statusText));return await e.json()}catch(e){throw e instanceof SyntaxError&&e.message.includes("Unexpected token")&&console.error("JSON Parse Error - received invalid response:",{url:n,error:e.message,suggestion:"Check if server is returning HTML instead of JSON"}),console.error("API Call failed:",e),e}}let s={initiate:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"qr";return i(r.ENDPOINTS.PAYMENTS,{method:"POST",body:JSON.stringify({amount:e,payment_method:t})})},checkStatus:e=>i("".concat(r.ENDPOINTS.PAYMENT_STATUS,"?transaction_id=").concat(e)),mock:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"success",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return i(r.ENDPOINTS.MOCK_PAYMENT,{method:"POST",body:JSON.stringify({action:e,amount:t})})}}},2410:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var r=n(5893),o=n(7294),i=n(1664),s=n.n(i),a=n(5925);function l(){let[e,t]=(0,o.useState)(null),[n,i]=(0,o.useState)(!1),[l,c]=(0,o.useState)(1e3),d=async e=>{i(!0),t(null);try{let n=await a.Kb.initiate(l);console.log("Payment initiated:",n);let r=await a.Kb.mock(e,l);if(console.log("Mock payment result:",r),n.transaction_id){let o=await a.Kb.checkStatus(n.transaction_id);console.log("Payment status:",o),t({step1_initiate:n,step2_mock:r,step3_status:o,flow_status:"success"===e?"completed":"cancelled"})}}catch(e){console.error("Payment flow error:",e),t({error:e instanceof Error?e.message:"Unknown error",flow_status:"failed"})}finally{i(!1)}};return(0,r.jsxs)("div",{style:{padding:"20px",fontFamily:"system-ui, sans-serif",maxWidth:"800px",margin:"0 auto"},children:[(0,r.jsx)("h1",{children:"\uD83E\uDDEA Payment Flow Test"}),(0,r.jsx)("p",{children:"決済フローの動作確認用テストページ"}),(0,r.jsx)("div",{style:{marginBottom:"20px"},children:(0,r.jsxs)("label",{children:["決済金額:",(0,r.jsx)("input",{type:"number",value:l,onChange:e=>c(Number(e.target.value)),style:{marginLeft:"10px",padding:"5px"}}),"円"]})}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)("button",{onClick:()=>d("success"),disabled:n,style:{padding:"10px 20px",margin:"0 10px",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"5px",cursor:n?"not-allowed":"pointer"},children:"✅ 決済成功テスト"}),(0,r.jsx)("button",{onClick:()=>d("cancel"),disabled:n,style:{padding:"10px 20px",margin:"0 10px",backgroundColor:"#ef4444",color:"white",border:"none",borderRadius:"5px",cursor:n?"not-allowed":"pointer"},children:"❌ 決済キャンセルテスト"})]}),n&&(0,r.jsx)("div",{style:{padding:"20px",backgroundColor:"#f3f4f6",borderRadius:"5px",marginBottom:"20px"},children:"\uD83D\uDD04 決済フローをテスト中..."}),e&&(0,r.jsxs)("div",{style:{padding:"20px",backgroundColor:e.error?"#fef2f2":"#f0fdf4",border:"1px solid ".concat(e.error?"#fca5a5":"#bbf7d0"),borderRadius:"5px"},children:[(0,r.jsx)("h3",{children:"テスト結果:"}),(0,r.jsx)("pre",{style:{backgroundColor:"#f9fafb",padding:"15px",borderRadius:"3px",overflow:"auto",fontSize:"12px"},children:JSON.stringify(e,null,2)}),e.flow_status&&(0,r.jsxs)("div",{style:{marginTop:"10px",fontWeight:"bold"},children:["フロー状態:",(0,r.jsxs)("span",{style:{color:"completed"===e.flow_status?"#10b981":"cancelled"===e.flow_status?"#ef4444":"#f59e0b"},children:["completed"===e.flow_status&&"✅ 完了","cancelled"===e.flow_status&&"❌ キャンセル","failed"===e.flow_status&&"⚠️ エラー"]})]})]}),(0,r.jsxs)("div",{style:{marginTop:"30px",padding:"15px",backgroundColor:"#fffbeb",border:"1px solid #fbbf24",borderRadius:"5px"},children:[(0,r.jsx)("h4",{children:"\uD83D\uDCDD チェックポイント:"}),(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:"✅ Console エラー（Invariant エラー）が出ないか"}),(0,r.jsx)("li",{children:"✅ Unmocked API intercepted エラーが出ないか"}),(0,r.jsx)("li",{children:"✅ /api/core/payments/ が 200/201 レスポンスを返すか"}),(0,r.jsx)("li",{children:"✅ 支払いフローが成功/キャンセルまで通るか"}),(0,r.jsx)("li",{children:"✅ Unexpected token '<' エラーが出ないか"})]})]}),(0,r.jsxs)("p",{style:{marginTop:"20px",color:"#6b7280",fontSize:"14px"},children:[(0,r.jsx)(s(),{href:"/",children:"← ホームに戻る"})," |",(0,r.jsx)(s(),{href:"/terminal-simple",style:{marginLeft:"10px"},children:"端末画面へ"})]})]})}}},function(e){e.O(0,[1664,2888,9774,179],function(){return e(e.s=8658)}),_N_E=e.O()}]);